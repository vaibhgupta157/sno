<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Edit Device</title>
<link rel="stylesheet" href="css/bootstrap.min.css">
<script src="js/jquery-3.5.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>


<script language="javascript">
        function addRow(tableID, rowLabel) {  
          var table = document.getElementById(tableID);  
          var rowCount = table.rows.length;  
          var row = table.insertRow(rowCount);  
    
          var cell1 = row.insertCell(0);
          var element1 = document.createElement("input");  
          element1.type = "text";  
          var id = rowLabel + '[' + (rowCount) + ']';
          element1.setAttribute('id', id)
          element1.setAttribute('name', id)
          element1.setAttribute('class', 'form-control')
          var value = window.prompt("Enter value: ");
          element1.setAttribute('value', value)
          cell1.appendChild(element1);  
    
          //Column 2  
          var cell2 = row.insertCell(1);  
          var element2 = document.createElement("input");  
          element2.type = "button";  
          //var btnName = tableID + (rowCount);  
          //element2.name = btnName;  
          element2.setAttribute('value', 'Delete'); // or element1.value = "button";  
          element2.onclick = function() {  
            removeRow(this, tableID, rowLabel);  
          }  
          cell2.appendChild(element2);  
        }
    
        function removeRow(row, tableID, rowLabel) {  
          var i=row.parentNode.parentNode.rowIndex;
          document.getElementById(tableID).deleteRow(i);
          var table = document.getElementById(tableID);
          var rowCount = table.rows.length;
          for (var i = 0; i < rowCount; i++) {
            var new_id = rowLabel + '[' + (i) + ']';
            if (table.rows[i].cells[0].childNodes.length > 1) {
              table.rows[i].cells[0].childNodes[1].id = new_id
              table.rows[i].cells[0].childNodes[1].name = new_id
            }
            else {
              table.rows[i].cells[0].childNodes[0].id = new_id
              table.rows[i].cells[0].childNodes[0].name = new_id
            }
          }
        }
      
      </script>

      <script language="javascript">
        function addListRow(tableID, key, device_param) {  
          var table = document.getElementById(tableID);  
          var rowCount = table.rows.length;  
          var row = table.insertRow(rowCount);  
    
          var cell1 = row.insertCell(0);
          var element1 = document.createElement("input");  
          element1.type = "text";  
          var id = key;
          element1.setAttribute('id', id)
          element1.setAttribute('name', id)
          element1.setAttribute('class', 'form-control')
          var value = window.prompt("Enter " + key + ": ");
          element1.setAttribute('value', value)
          cell1.appendChild(element1);  
          
          //Column 2  
          var cell2 = row.insertCell(1);  
          var element2 = document.createElement("input");  
          element2.type = "button";  
          //var btnName = tableID + (rowCount);  
          //element2.name = btnName;  
          element2.setAttribute('value', 'Delete'); // or element1.value = "button";  
          element2.onclick = function() {  
            removeListRow(this, tableID, rowLabel);  
          }  
          cell2.appendChild(element2);
          device_param[value] = {}  
        }
    
        function removeListRow(row, tableID, rowLabel) {  
          var i=row.parentNode.parentNode.rowIndex;
          document.getElementById(tableID).deleteRow(i);
          var table = document.getElementById(tableID);
          var rowCount = table.rows.length;
          for (var i = 0; i < rowCount; i++) {
            var new_id = rowLabel + '[' + (i) + ']';
            if (table.rows[i].cells[0].childNodes.length > 1) {
              table.rows[i].cells[0].childNodes[1].id = new_id
              table.rows[i].cells[0].childNodes[1].name = new_id
            }
            else {
              table.rows[i].cells[0].childNodes[0].id = new_id
              table.rows[i].cells[0].childNodes[0].name = new_id
            }
          }
        }
      
      </script>
  

</head>
<body>

        <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title">Edit Config</h4>
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    
                        <form action ="/devices/device/{{device}}/{{module}}" method = "POST">
                            <div class="form-group">
                          {% set module_details = namespace(module_dict=module_dict) %}
                          {% set param_tree = namespace(param='') %}
                          {% for p, value in module_dict.tree.items() recursive %}
                            
                            {% if p in module_details.module_dict %}
                              {% set device_param = module_details.module_dict[p] %}
                            {% else %}
                              {% set device_param = "" %}
                            {% endif %}

                            {% if param_tree.param %}
                              {% set param = param_tree.param + '.' + p %}
                            {% else %}
                              {% set param = p %}
                            {% endif %}

                            {% if value.yang_type == 'leaf' %}
                              {% if value.type == 'string' %}
                                <label for={{param}}>{{param}}:</label>
                                <input type="text" id={{param}} name={{param}} class="form-control" value={{device_param}}><br>
                              {% elif value.type == 'uint32' %}
                                <label for={{param}}>{{param}}:</label>
                                <input type="number" id={{param}} name={{param}} class="form-control" value={{device_param}}><br>
                              {% elif value.type == 'enumeration' %}
                                <label for={{param}}>{{param}}:</label>
                                <select name={{param}} id={{param}} class="form-control">
                                {% for enum in value.enum %}
                                  {% if enum == device_param %}
                                    <option value={{enum}} selected>{{enum}}</option>
                                  {% else %}
                                    <option value={{enum}}>{{enum}}</option>
                                  {% endif %}
                                {% endfor %}
                                </select><br>
                              {% else %}
                                <label for={{param}}>{{param}}:</label>
                                <input type="text" id={{param}} name={{param}} class="form-control" value={{device_param}}><br>
                              {% endif %}
                            
                            {% elif value.yang_type == 'leaf-list' %}
                              <table id={{param}}>
                              {% for item in device_param %}
                                {% set item_label = param + '[' + loop.index0|string + ']' %}
                                <tr>
                                  <td>
                                    <input type={{value.type}} id={{item_label}} name={{item_label}} class="form-control" value="{{item}}"">
                                  </td>
                                  <td>
                                    {% set button_label = param + loop.index0|string %}
                                    <input type="button" value="Delete" onclick="removeRow(this, '{{param}}', '{{item_label}}')">
                                  </td>
                                </tr>
                              {% endfor %}
                              </table>
                              <input type="button" value="Add" onclick="addRow('{{param}}', '{{item_label}}')">
                            {% elif value.yang_type == 'container' %}
                              <label for={{p}}>{{p}}:</label><br>
                              {% set orig_dict = module_details.module_dict %}
                              {% set orig_param = param_tree.param %}
                              {% set module_details.module_dict = device_param %}
                              {% set param_tree.param =  param %}
                              {{ loop(value.items())}}
                              {% set param_tree.param =  orig_param %}
                              {% set module_details.module_dict = orig_dict %}
                            
                            {% elif value.yang_type == 'list' %}
                              <label for={{p}}>{{p}}:</label><br>
                              <input type="button" value="Add" onclick="addListRow('{{param}}', '{{value.key}}', '{{device_param}}')"><br>
                              <table id={{param}}>
                              {% set orig_dict = module_details.module_dict %}
                              {% set orig_param = param_tree.param %}
                              {% set module_details.module_dict = device_param %}
                              {% set param_tree.param =  param %}
                              {% for item in device_param %}
                                {% set item_label = param + '.' + item[value.key] %}
                                <tr>
                                  <td>
                                    item[value.key]
                                    {{ loop(value.items())}}
                                  </td>
                                  <td>
                                    {% set button_label = param + loop.index0|string %}
                                    <input type="button" value="Delete" onclick="removeListRow(this, '{{param}}', '{{item_label}}')">
                                  </td>
                                </tr>
                              {% endfor %}
                              </table>
                              
                              {% set param_tree.param =  orig_param %}
                              {% set module_details.module_dict = orig_dict %}
                            {% endif %}
                          {% endfor %}  
                      
                          
                          <p><br>
                            <button type="submit" class="btn btn-info btn-sm">Edit</button></p>
                            </div>
                          </form>

                </div>
                <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
              </div>

</body>
</html>